## Kumo
### Useful links
* [Cloudformation](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide)
* [AWS IAM service](https://aws.amazon.com/iam/)
* [Troposphere](https://github.com/cloudtools/troposphere)
### Create your first stack with kumo
Kumo is a tool which help you manage and deploy your infrastructure using Cloudformation templates which generated by `troposphere`. With kumo you can easily create infrastructure for different Environment(dev, stage, prod).

First of all you need to create two files:
* *cloudformation.py* - here you will describe you infrastructure using `troposphere`
* *settings_(dev|stage|prod)* - settings for your ENV in [hocon](https://github.com/typesafehub/config/blob/master/HOCON.md) format, needs to include all parameters for the cloudformation template + stack name

Let's create simple `settings_dev.conf`:
```bash
cloudformation {
  StackName = "gcdt-sample-stack"
  VPCId = "lookup:stack:pnb-dev:DefaultVPCId"
  ScaleMinCapacity = "1"
  ScaleMaxCapacity = "1"
  HostedZone = "dev.pnb.glomex.cloud."
  ELBDNSName = "supercars"
  InstanceType = "t2.micro"
  BaseStackName = "pnb-dev"
  LambdaLookupARN = "arn:aws:lambda:eu-west-1:028693506758:function:pnb-dev-lambdaEC2Basics-6UJ7UUM24G09"
  DefaultInstancePolicyARN = "lookup:stack:pnb-dev:DefaultInstancePolicyARN"
  AMI = "lookup:baseami"
}
```
In `VPCId` and `DefaultInstancePolicyARN` we use lookup plugin which will search in stack name `pnb-dev` output `DefaultVPCId` and `DefaultInstancePolicyARN` and use values in our template. Instead of `pnb-dev` you can provide your stack name or use hardcoded value(not recommended).
It's time to create our first Infrastructure as Code. Let's to this.
Here is simple [cloudformation.py](https://github.com/glomex/gcdt-sample-stack/blob/master/infrastructure/cloudformation.py) script. Use it to create your first stack.

### Deploy stack to AWS
Before running deployment we need to set some necessary ENV variables
```bash
$ export ENV=dev
$ export AWS_DEFAULT_PROFILE=glomex # Default profile which generate aws-mfa
$ export AWS_DEFAULT_REGION=eu-west-1
```
Run your first infrastructure deployment. It's really easy.
```bash
$ kumo deploy
```
### Useful kumo command
#### deploy
will create or update a CloudFormation stack. Running this command you shoud be in the same directory with `cloudformation.py`

to be able to update a stack that is protected by a stack policy you need to supply *â€“override-stack-policy*
#### list
will list all available CloudFormation stacks
#### delete
will delete a CloudFormation stack
#### generate
will generate the CloudFormation template for the given stack and write it to your current working directory.
#### preview
will create a CloudFormation ChangeSet with your current changes to the template
